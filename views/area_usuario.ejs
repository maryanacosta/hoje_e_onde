<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Área - Hoje É Onde?</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css"> 
</head>
<body>
    <div class="container my-5">
        <h2 class="text-warning mb-4">Minha Área, <%= userName %></h2>
        <a href="/" class="btn btn-outline-secondary mb-4">Voltar para a Home</a>

        <h4 class="mb-3">Eventos que Publiquei:</h4>
        <% if (eventosPublicados.length === 0) { %>
            <div class="alert alert-info">Você ainda não submeteu nenhum evento. <a href="/submeter-evento">Submeter agora</a>.</div>
        <% } else { %>
            <div class="list-group mb-5">
                <% eventosPublicados.forEach(e => { %>
                    <a href="/evento/<%= e.id %>" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <strong><%= e.titulo %></strong> (<%= e.tipo %>)
                            <p class="mb-0 small text-muted">Em: <%= e.local %> | <%= e.duracao %> | Data: <%= e.data %></p>
                        </div>
                        <% if (e.aprovado === 1) { %>
                            <span class="badge bg-success">APROVADO (PUBLICADO)</span>
                        <% } else if (e.aprovado === 0) { %>
                            <span class="badge bg-warning text-dark">PENDENTE DE APROVAÇÃO</span>
                        <% } else { %>
                            <span class="badge bg-danger">RECUSADO</span>
                        <% } %>
                    </a>
                <% }); %>
            </div>
        <% } %>

        <h4 class="mb-3">Eventos Salvos (Minha Lista Pessoal):</h4>
        <% if (eventosSalvos.length === 0) { %>
            <div class="alert alert-info">Você não salvou nenhum evento.</div>
        <% } else { %>
            <div class="row row-cols-1 row-cols-md-2 g-4">
                <% eventosSalvos.forEach(e => { %>
                    <div class="col" id="evento-salvo-<%= e.id %>"> 
                        <div class="card h-100 shadow-sm">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title"><%= e.titulo %></h5>
                                <p class="card-text small text-muted">
                                    Em: <%= e.local %><br>
                                    Data: <%= e.data %> | Horário: <%= e.duracao %>
                                </p>
                                <div class="mt-auto d-flex justify-content-between align-items-center">
                                    <a href="/evento/<%= e.id %>" class="btn btn-sm btn-outline-warning">Ver Detalhes</a>
                                    
                                    <button class="btn btn-sm btn-outline-danger remover-salvo-btn" data-evento-id="<%= e.id %>">
                                        ❌ Remover
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } %>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        document.querySelectorAll('.remover-salvo-btn').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault(); 
                e.stopPropagation(); 

                const eventoId = this.getAttribute('data-evento-id');
                const elementoEvento = document.getElementById(`evento-salvo-${eventoId}`);

               // pergunta de confirmação antes de remover evento da lista de salvos
                Swal.fire({
                    title: 'Tem certeza?',
                    text: "Você deseja remover este evento dos seus salvos?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#dc3545', 
                    cancelButtonColor: '#6c757d',
                    confirmButtonText: 'Sim, remover.',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    // se o usuário confirmou
                    if (result.isConfirmed) {
                        
                        // faz a requisição para remover o evento salvo
                        fetch('/remover-salvo', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ eventoId: eventoId })
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                // sucesso na remoção
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Removido!',
                                    text: data.message,
                                    timer: 1500,
                                    showConfirmButton: false
                                });

                                // remove o elemento da lista visualmente
                                if (elementoEvento) {
                                    elementoEvento.style.transition = 'all 0.5s ease';
                                    elementoEvento.style.opacity = '0';
                                    elementoEvento.style.transform = 'scale(0.9)';
                                    
                                    setTimeout(() => {
                                        elementoEvento.remove();
                                    }, 500);
                                }
                            } else {
                                // se houve falha na remoção
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Ops...',
                                    text: data.message
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Erro:', error);
                            Swal.fire({
                                icon: 'error',
                                title: 'Erro',
                                text: 'Erro de conexão ao tentar remover.'
                            });
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>